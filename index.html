<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>四字成語暨詞彙查詢系統｜漫步時光</title>

    <!-- nav -->
    <link rel="stylesheet" href="nav.css">
    <script src="nav.js"></script>

    <!-- style -->
    <link rel="stylesheet" href="index.css">
    
    <!-- for GAD -->
    <script src="https://storage.googleapis.com/teleworker-public-storage/gad_js/net.min.js" async></script>

    <!-- for GSC -->
    <meta name="google-site-verification" content="u3srgllAfDRcciEM-8F7IFCc-GNVPU9S9Lcu-m0OUb4" />
    
    <!-- for Description -->
    <meta name="description" content="提供教育部《重編國語辭典修訂本》四字成語與詞彙查詢。可根據指定文字位置精確搜尋，適用於成語接龍練習、腦力激盪與國語文教學工具。">
    <meta name="keywords" content="成語查詢, 教育部成語典, 四字詞彙, 成語接龍, 重編國語辭典修訂本, 國語文工具, 撰風旅食">
    <meta name="author" content="撰風 (Shengle Wang)">
    <link rel="canonical" href="https://jfsblog.github.io/Idiom-Search-Engine/">

    <!-- for Open Graph -->
    <meta property="og:title" content="四字成語暨詞彙查詢系統｜漫步時光">
    <meta property="og:description" content="根據指定位置搜尋特定文字的成語 or 四字詞彙，收錄自教育部國語辭典公眾授權網。">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://jfsblog.github.io/Idiom-Search-Engine/">
    <meta property="og:image" content="thumbnail.png">
    <meta property="og:site_name" content="漫步時光">

    <!-- for X -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="四字成語暨詞彙查詢系統">
    <meta name="twitter:description" content="精確搜尋教育部四字詞彙，輔助成語接龍與文字練習。">
    <meta name="twitter:image" content="thumbnail.png">

    <!-- for JSON-LD -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "四字成語暨詞彙查詢系統",
      "description": "根據文字位置查詢符合條件的教育部四字成語與詞彙。",
      "applicationCategory": "EducationalApplication",
      "operatingSystem": "Any",
      "author": {
        "@type": "Person",
        "name": "Shengle Wang",
        "url": "https://jfsblog.com/about"
      }
    }
    </script>
        
    <!-- import Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&family=Noto+Serif+TC:wght@600;900&display=swap" rel="stylesheet">
</head>
<body>

    <!-- 載入中遮罩 -->
    <div id="loader-overlay">
        <div class="loader-spinner"></div>
        <div class="loader-text" id="loader-status">正在載入典籍資料...</div>
        <div id="progress-percent">0%</div>
    </div>

    <!-- 操作教學彈窗 -->
    <div id="tutorialModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeTutorial">&times;</span>
            <h2>操作教學</h2>
            <div class="modal-body">
                <h3>一、基本搜尋方式</h3>
                <ul>
                    <li>在任一空格中輸入單一文字（例如「風」）。</li>
                    <li>系統會即時篩選符合該位置文字的四字詞彙。</li>
                    <li>可同時輸入多個位置進行精確篩選。</li>
                </ul>
                <h3>二、成語接龍技巧</h3>
                <ul>
                    <li>若要找「風」開頭成語，請在第一格輸入「風」。</li>
                    <li>若要找第二字為「山」，請在第二格輸入「山」。</li>
                </ul>
                <h3>三、結果說明</h3>
                <ul>
                    <li>下方會顯示符合條件的詞彙數量。</li>
                    <li>點擊詞彙名稱，可連至教育部辭典原始頁面。</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- 系統說明彈窗 (已還原詳細內容) -->
    <div id="instructionModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeModal">&times;</span>
            <h2>系統說明</h2>
            <div class="modal-body">
                <p>本系統整理自教育部國語辭典公眾授權網釋出之《重編國語辭典修訂本》、《國語辭典簡編本》、《國語小字典》及《成語典》資料，提供四字成語與常見四字詞彙之位置搜尋功能。</p>
                <p>使用者可於指定位置輸入文字，系統將即時篩選符合條件之詞彙，適用於成語接龍練習、國語文教學與文字應用輔助。</p>

                <h3>資料來源與授權條款</h3>
                <p>本網站所使用之辭典資料，係依據中華民國教育部所公告之「創用CC－姓名標示－禁止改作 3.0 臺灣授權條款（CC BY-ND 3.0 TW）」釋出。</p>

                <ul>
                    <li>允許重製、散布與傳輸著作（包括商業性利用）。</li>
                    <li>不得修改、改作或變更原始著作內容。</li>
                    <li>使用時須標示資料來源及授權資訊。</li>
                </ul>

                <p>
                    本網站僅提供資料索引與搜尋功能，辭典原始內容與著作權仍屬教育部所有。
                    點擊詞彙名稱可連至教育部辭典官方頁面查閱完整內容。
                </p>

                <h3>官方聲明</h3>
                <p>
                    本網站為民間開發之工具網站，非教育部官方網站，與教育部無隸屬或合作關係。
                </p>

                <h3>典籍官方連結</h3>
                <ul>
                    <li><strong>成語典：</strong>
                        <a href="https://dict.idioms.moe.edu.tw/search.jsp" target="_blank" rel="noopener">教育部《成語典》</a>
                    </li>
                    <li><strong>修訂本：</strong>
                        <a href="https://dict.revised.moe.edu.tw/search.jsp?md=1" target="_blank" rel="noopener">教育部《重編國語辭典修訂本》</a>
                    </li>
                    <li><strong>授權公告：</strong>
                        <a href="https://language.moe.gov.tw/001/Upload/Files/site_content/M0001/respub/dict_reviseddict_download.html" target="_blank" rel="noopener">教育部國語辭典公眾授權網</a>
                    </li>
                </ul>

                <h3>關於本系統</h3>
                <ul>
                    <li><strong>作者：</strong>
                        <a href="https://jfsblog.com/about" target="_blank">撰風 (Shengle Wang)</a>
                    </li>
                    <li><strong>創建日期：</strong>2024/11/16</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="container" id="mainContainer" style="margin-top: 20px;">
        <!-- 優化後的資訊連結區，增加與頂部導覽列的間距 -->
        <div id="info" style="padding-top: 15px; margin-bottom: 20px;">
            <span id="showTutorial" class="links">操作教學</span>
            <span>｜</span>
            <span id="showInstructions" class="links">系統說明</span>
        </div>

        <!-- 主搜尋區域 -->
        <div class="search-section" id="mainSearchSection">
            <span class="search-label">－ 請於對應空格內輸入文字 －</span>
            <div class="search-box">
                <input type="text" class="input-field main-input" data-index="0" placeholder="..." maxlength="1" disabled>
                <input type="text" class="input-field main-input" data-index="1" placeholder="..." maxlength="1" disabled>
                <input type="text" class="input-field main-input" data-index="2" placeholder="..." maxlength="1" disabled>
                <input type="text" class="input-field main-input" data-index="3" placeholder="..." maxlength="1" disabled>
            </div>
            <div class="statistics">
                <span id="statisticsText" style="display: none;"></span>
            </div>
        </div>

        <div class="table-wrapper">
            <table id="resultsTable" style="display: none;">
                <thead>
                    <tr>
                        <th>詞彙</th>
                        <th>釋義</th>
                    </tr>
                </thead>
                <tbody id="resultsBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        let idioms = [];

        const loadJSON = async () => {
            const overlay = document.getElementById('loader-overlay');
            const container = document.getElementById('mainContainer');
            const statusText = document.getElementById('loader-status');
            const progressText = document.getElementById('progress-percent');
            const allInputs = document.querySelectorAll('.input-field');

            try {
                const response = await fetch('https://idiom.strolltimes.com/dict_revised_2015_20240927.json');
                if (!response.ok) throw new Error("找不到資料庫檔案");

                const contentLength = response.headers.get('content-length');
                const total = parseInt(contentLength, 10);
                
                const reader = response.body.getReader();
                let loaded = 0;
                let chunks = [];

                while(true) {
                    const {done, value} = await reader.read();
                    if (done) break;
                    chunks.push(value);
                    loaded += value.length;
                    if (total) {
                        const percent = Math.round((loaded / total) * 100);
                        progressText.textContent = `${percent}%`;
                    }
                }

                statusText.textContent = "資料整理中...";
                const allChunks = new Uint8Array(loaded);
                let position = 0;
                for (let chunk of chunks) {
                    allChunks.set(chunk, position);
                    position += chunk.length;
                }
                
                const jsonString = new TextDecoder("utf-8").decode(allChunks);
                const data = JSON.parse(jsonString);
                
                idioms = data.map(row => ({
                    idiom: row['字詞名'],
                    definition: row['釋義'],
                }));

                statusText.textContent = "載入完成！";
                setTimeout(() => {
                    overlay.classList.add('hidden');
                    container.classList.add('loaded');
                    allInputs.forEach(input => {
                        input.disabled = false;
                        input.placeholder = "";
                    });
                }, 600);

            } catch (error) {
                console.error('載入出錯:', error);
                statusText.textContent = "資料載入失敗";
                document.querySelector('.loader-spinner').style.display = 'none';
            }
        };

        const showResults = () => {
            const mainInputs = document.querySelectorAll('.main-input');
            const inputs = Array.from(mainInputs).map(i => i.value.trim());

            const resultsTable = document.getElementById('resultsTable');
            const statisticsText = document.getElementById('statisticsText');
            const resultsBody = document.getElementById('resultsBody');

            if (inputs.every(input => input === "")) {
                resultsTable.style.display = 'none';
                statisticsText.style.display = 'none';
                return;
            }

            const filteredResults = idioms.filter(item => {
                if (!item.idiom || item.idiom.length < 4) return false;
                return inputs.every((input, index) => {
                    return input === "" || item.idiom[index] === input;
                });
            });

            statisticsText.textContent = `找到 ${filteredResults.length} 筆詞彙`;
            statisticsText.style.display = 'block';

            resultsBody.innerHTML = '';
            if (filteredResults.length > 0) {
                resultsTable.style.display = 'table';
                filteredResults.slice(0, 500).forEach(item => {
                    const shortDef = item.definition ? item.definition.split('\n')[0] : "暫無釋義。";
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="idiom-word">
                            <a href="https://dict.revised.moe.edu.tw/search.jsp?md=1&word=${encodeURIComponent(item.idiom)}" target="_blank">
                                ${item.idiom}
                            </a>
                        </td>
                        <td class="explanation-text">${shortDef}</td>
                    `;
                    resultsBody.appendChild(row);
                });
            } else {
                resultsTable.style.display = 'none';
                statisticsText.textContent = "查無符合詞彙。";
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            const allInputs = document.querySelectorAll('.main-input, .input-mini');
            allInputs.forEach(input => {
                input.addEventListener('input', (e) => {
                    const idx = e.target.dataset.index;
                    const val = e.target.value;
                    document.querySelectorAll(`[data-index="${idx}"]`).forEach(el => {
                        el.value = val;
                    });
                    showResults();
                });
            });

            const setupModal = (btnId, modalId, closeId) => {
                const btn = document.getElementById(btnId);
                const modal = document.getElementById(modalId);
                const close = document.getElementById(closeId);
                if(!btn || !modal) return;

                btn.onclick = () => {
                    modal.style.display = "flex";
                    setTimeout(() => modal.classList.add('active'), 20);
                };
                close.onclick = () => {
                    modal.classList.remove('active');
                    setTimeout(() => modal.style.display = "none", 400);
                };
                window.addEventListener('click', (e) => { if (e.target == modal) close.onclick(); });
            };

            setupModal('showTutorial', 'tutorialModal', 'closeTutorial');
            setupModal('showInstructions', 'instructionModal', 'closeModal');

            loadJSON();
        });
    </script>
</body>
</html>